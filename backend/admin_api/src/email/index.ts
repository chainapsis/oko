import type {
  EmailResult,
  SendEmailOptions,
  SMTPConfig,
} from "@oko-wallet/oko-types/admin";
import he from "he";
import nodemailer from "nodemailer";

export function sendEmailWithTransporter(
  transporter: nodemailer.Transporter,
  options: SendEmailOptions,
): Promise<nodemailer.SentMessageInfo> {
  return transporter.sendMail(options);
}

export async function sendEmail(
  options: SendEmailOptions,
  smtp_config: SMTPConfig,
): Promise<EmailResult> {
  try {
    const transporter = nodemailer.createTransport({
      host: smtp_config.smtp_host,
      port: smtp_config.smtp_port,
      auth: {
        user: smtp_config.smtp_user,
        pass: smtp_config.smtp_pass,
      },
      secure: false, // false for 587(SMRTTLS)
    });
    const info = await transporter.sendMail({
      from: options.from,
      to: options.to,
      subject: options.subject,
      text: options.text,
      html: options.html,
    });

    return {
      success: true,
      messageId: info.messageId,
    };
  } catch (error) {
    console.error("Email send error:", error);
    return {
      success: false,
      error: `Email send error: ${error instanceof Error ? error.message : String(error)}`,
    };
  }
}

// Test SMTP connection and transporter
export function getTransporter(
  host: string,
  port: number,
  user: string,
  pass: string,
): nodemailer.Transporter {
  return nodemailer.createTransport({
    host,
    port,
    auth: {
      user,
      pass,
    },
    secure: false, // false for 587(SMRTTLS)
  });
}

// FOR TEST
export async function testEmailConnection(
  host: string,
  port: number,
  user: string,
  pass: string,
): Promise<boolean> {
  try {
    const transporter = getTransporter(host, port, user, pass);
    await transporter.verify();
    console.log("SMTP connection verified");
    return true;
  } catch (error) {
    console.error("SMTP connection failed:", error);
    return false;
  }
}

export async function sendCustomerUserPasswordEmail(
  email: string,
  password: string,
  from_email: string,
  smtp_config: SMTPConfig,
) {
  const subject = "Temporary password for your Oko Dashboard login";
  const escapedPassword = he.escape(password);

  const html = `
    <!DOCTYPE html><!--trfcPQVyshtjcLcHYz4z8--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/header.png"/><link rel="preload" as="image" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-left.png"/><link rel="preload" as="image" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-right.png"/><link rel="preload" as="image" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-left.png"/><link rel="preload" as="image" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-right.png"/><link rel="preload" as="image" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/icon-demo.png"/><link rel="preload" as="image" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/icon-docs.png"/><link rel="preload" as="image" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/icon-inquiries.png"/><link rel="preload" as="image" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/logo-footer.png"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-d7602772852bf587.js"/><script src="/_next/static/chunks/87c73c54-0375ba195de27293.js" async=""></script><script src="/_next/static/chunks/18-61ad5d17019a82fb.js" async=""></script><script src="/_next/static/chunks/main-app-fa13277d8c2dafbe.js" async=""></script><title>Oko Email Template</title><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><div style="background-color:#ededed;font-family:Inter, Arial, sans-serif"><table align="center" role="presentation" cellPadding="0" cellSpacing="0" style="width:100%;background-color:#ededed"><tbody><tr><td style="padding:32px 0 32px 0"><table align="center" role="presentation" cellPadding="0" cellSpacing="0" style="width:600px;max-width:100%;margin:0 auto;border-spacing:0"><tbody><tr><td style="padding:0"><table role="presentation" style="width:100%;background-color:#ededed;border-radius:28px;border-spacing:0" cellPadding="0" cellSpacing="0"><tbody><tr><td style="padding-top:8px;padding-left:8px;padding-right:8px;padding-bottom:8px"><div style="padding:2px"><div style="position:relative;width:100%"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/header.png" width="584" alt="Red Oko header with &#x27;Welcome to Oko&#x27; text" style="display:block;width:584px;max-width:100%;border-radius:20px"/></div><div style="height:972px;width:100%"><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td align="center" valign="top" style="padding-top:32px"><table role="presentation" width="360" cellPadding="0" cellSpacing="0" style="width:360px;max-width:100%;border-spacing:0"><tbody><tr><td valign="top" style="height:793px"><table role="presentation" width="360" cellPadding="0" cellSpacing="0" style="width:360px;max-width:100%;border-spacing:0;height:793px"><tbody><tr><td><p style="font-family:Inter, Arial, sans-serif;margin:0;color:#1c1b1f;text-align:left;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em">Hi there,<br/><br/>Welcome to Oko, and thanks for integrating with us!</p></td></tr><tr><td height="33.72" style="height:33.72px;line-height:33.72px;font-size:0"> </td></tr><tr><td><p style="font-family:Inter, Arial, sans-serif;margin:0;color:#1c1b1f;text-align:left;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em">You can now log in to the Oko dApp Dashboard using the email address you shared with us and the temporary password below.</p></td></tr><tr><td height="32" style="height:32px;line-height:32px;font-size:0"> </td></tr><tr><td><table role="presentation" width="360" align="center" cellPadding="0" cellSpacing="0" style="width:360px;max-width:100%;border-spacing:0"><tbody><tr><td style="background-color:#ffffff;border-radius:16px"><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td align="left" style="padding:10px 0 0 10px"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-left.png" width="16" height="16" alt="" style="display:block;border:0;outline:none;text-decoration:none"/></td><td align="right" style="padding:10px 10px 0 0"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-right.png" width="16" height="16" alt="" style="display:block;border:0;outline:none;text-decoration:none"/></td></tr></tbody></table><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td align="center" valign="top" style="padding:32px 32px 24px 32px"><table role="presentation" width="296" align="center" cellPadding="0" cellSpacing="0" style="width:296px;max-width:100%;margin:0 auto;border-spacing:0"><tbody><tr><td style="height:26px"><p style="font-family:Inter, Arial, sans-serif;margin:0;color:#1c1b1f;text-align:center;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em">Your temporary password is</p></td></tr><tr><td height="8" style="height:8px;line-height:8px;font-size:0"> </td></tr><tr><td style="height:30px"><p style="font-family:Inter, Arial, sans-serif;margin:0;color:#1c1b1f;text-align:center;font-weight:600;font-size:20px;line-height:150%;letter-spacing:-0.01em">${escapedPassword}</p></td></tr></tbody></table><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td height="24" style="height:24px;line-height:24px;font-size:0"> </td></tr><tr><td align="center"><table role="presentation" cellPadding="0" cellSpacing="0" style="border-spacing:0;margin:0 auto"><tbody><tr><td align="center" style="background-color:#1c1b1f;border-radius:222px;height:45px"><a href="https://dapp.oko.app" style="display:inline-block;padding:12px 32px;font-family:Inter, Arial, sans-serif;font-weight:500;font-size:14px;line-height:150%;letter-spacing:-0.01em;color:#fffffe;text-decoration:none;text-align:center">Sign In</a></td></tr></tbody></table></td></tr></tbody></table><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td height="24" style="height:24px;line-height:24px;font-size:0"> </td></tr><tr><td align="center"><table role="presentation" width="296" cellPadding="0" cellSpacing="0" style="width:296px;max-width:100%;border-spacing:0"><tbody><tr><td><p style="font-family:Inter, Arial, sans-serif;margin:0;color:rgba(28, 27, 31, 0.5);text-align:center;font-weight:500;font-size:14px;line-height:150%;letter-spacing:-0.01em">Please sign in and update your password after your first login.</p></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td align="left" style="padding:0 0 10px 10px"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-left.png" width="16" height="16" alt="" style="display:block;border:0;outline:none;text-decoration:none"/></td><td align="right" style="padding:0 10px 10px 0"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-right.png" width="16" height="16" alt="" style="display:block;border:0;outline:none;text-decoration:none"/></td></tr></tbody></table></td></tr></tbody></table></td></tr><tr><td height="32" style="height:32px;line-height:32px;font-size:0"> </td></tr><tr><td><table role="presentation" width="360" cellPadding="0" cellSpacing="0" style="width:360px;max-width:100%;border-spacing:0"><tbody><tr><td><p style="font-family:Inter, Arial, sans-serif;margin:0;color:#1c1b1f;text-align:left;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em">Here are a few links that may help during integration:</p></td></tr><tr><td height="16" style="height:16px;line-height:16px;font-size:0"> </td></tr></tbody></table><table role="presentation" width="360" align="center" cellPadding="0" cellSpacing="0" style="width:360px;max-width:100%;border-spacing:0"><tbody><tr><td><table role="presentation" width="360" cellPadding="0" cellSpacing="0" style="width:360px;border-spacing:0"><tbody><tr><td width="16" style="width:16px;padding-right:12px"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/icon-demo.png" width="16" height="16" alt="" style="display:block;width:16px;height:16px"/></td><td><a href="https://demo.oko.app/" style="font-family:Inter, Arial, sans-serif;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em;color:#1c1b1f;text-decoration:underline">Demo</a></td></tr><tr><td height="8" colSpan="2" style="height:8px;line-height:8px;font-size:0"> </td></tr><tr><td width="16" style="width:16px;padding-right:12px"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/icon-docs.png" width="16" height="16" alt="" style="display:block;width:16px;height:16px"/></td><td><a href="https://docs.oko.app/docs" style="font-family:Inter, Arial, sans-serif;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em;color:#1c1b1f;text-decoration:underline">Docs</a></td></tr><tr><td height="8" colSpan="2" style="height:8px;line-height:8px;font-size:0"> </td></tr><tr><td width="16" style="width:16px;padding-right:12px"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/icon-inquiries.png" width="16" height="16" alt="" style="display:block;width:16px;height:16px"/></td><td><a href="https://oko-wallet.canny.io/integration-support-inquiries" style="font-family:Inter, Arial, sans-serif;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em;color:#1c1b1f;text-decoration:underline">Integration Inquiries</a></td></tr></tbody></table></td></tr><tr><td height="32" style="height:32px;line-height:32px;font-size:0"> </td></tr><tr><td><p style="margin:0;font-family:Inter, Arial, sans-serif;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em;color:#1c1b1f">Thanks!</p></td></tr><tr><td height="32" style="height:32px;line-height:32px;font-size:0"> </td></tr><tr><td align="center"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/logo-footer.png" width="64" height="25" alt="Oko Logo" style="display:block;width:64px;height:25px"/></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></div></div></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></div><!--$--><!--/$--><script src="/_next/static/chunks/webpack-d7602772852bf587.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:"$Sreact.fragment"\n2:I[5341,[],""]\n3:I[25,[],""]\na:I[4431,[],""]\n"])</script><script>self.__next_f.push([1,"0:{"P":null,"b":"trfcPQVyshtjcLcHYz4z8","p":"","c":["","oko"],"i":false,"f":[[["",{"children":["oko",{"children":["__PAGE__",{}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[null,["$","html",null,{"lang":"en","children":["$","body",null,{"children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\\"Segoe UI\\",Roboto,Helvetica,Arial,sans-serif,\\"Apple Color Emoji\\",\\"Segoe UI Emoji\\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}],{"children":["oko",["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":[["$","div",null,{"style":{"backgroundColor":"#ededed","fontFamily":"Inter, Arial, sans-serif"},"children":["$","table",null,{"align":"center","role":"presentation","cellPadding":"0","cellSpacing":"0","style":{"width":"100%","backgroundColor":"#ededed"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"style":{"padding":"32px 0 32px 0"},"children":["$","table",null,{"align":"center","role":"presentation","cellPadding":"0","cellSpacing":"0","style":{"width":"600px","maxWidth":"100%","margin":"0 auto","borderSpacing":"0"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"style":{"padding":"0"},"children":["$","table",null,{"role":"presentation","style":{"width":"100%","backgroundColor":"#ededed","borderRadius":"28px","borderSpacing":"0"},"cellPadding":"0","cellSpacing":"0","children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"style":{"paddingTop":"8px","paddingLeft":"8px","paddingRight":"8px","paddingBottom":"8px"},"children":["$","div",null,{"style":{"padding":"2px"},"children":[["$","div",null,{"style":{"position":"relative","width":"100%"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/header.png","width":"584","alt":"Red Oko header with 'Welcome to Oko' text","style":{"display":"block","width":"584px","maxWidth":"100%","borderRadius":"20px"}}]}],["$","div",null,{"style":{"height":"972px","width":"100%"},"children":["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":{"borderSpacing":"0"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"align":"center","valign":"top","style":{"paddingTop":"32px"},"children":["$","table",null,{"role":"presentation","width":"360","cellPadding":"0","cellSpacing":"0","style":{"width":"360px","maxWidth":"100%","borderSpacing":"0"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"valign":"top","style":{"height":"793px"},"children":["$","table",null,{"role":"presentation","width":"360","cellPadding":"0","cellSpacing":"0","style":{"width":"360px","maxWidth":"100%","borderSpacing":"0","height":"793px"},"children":["$","tbody",null,{"children":[["$","tr",null,{"children":["$","td",null,{"children":["$","p",null,{"style":{"fontFamily":"Inter, Arial, sans-serif","margin":0,"color":"#1c1b1f","textAlign":"left","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em"},"children":["Hi there,",["$","br",null,{}],["$","br",null,{}],"Welcome to Oko, and thanks for integrating with us!"]}]}]}],["$","tr",null,{"children":["$","td",null,{"height":"33.72","style":{"height":"33.72px","lineHeight":"33.72px","fontSize":"0"},"children":" "}]}],["$","tr",null,{"children":["$","td",null,{"children":["$","p",null,{"style":{"fontFamily":"Inter, Arial, sans-serif","margin":0,"color":"#1c1b1f","textAlign":"left","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em"},"children":"You can now log in to the Oko dApp Dashboard using the email address you shared with us and the temporary password below."}]}]}],"$L4","$L5","$L6","$L7"]}]}]}]}]}]}]}]}]}]}]}]]}]}]}]}]}]}]}]}]}]}]}]}]}]}],null,"$L8"]}],{},null,false]},null,false]},null,false],"$L9",false]],"m":"$undefined","G":["$a",[]],"s":false,"S":true}\n"])</script><script>self.__next_f.push([1,"b:I[5104,[],"OutletBoundary"]\nd:I[7158,[],"AsyncMetadataOutlet"]\nf:I[5104,[],"ViewportBoundary"]\n11:I[5104,[],"MetadataBoundary"]\n12:"$Sreact.suspense"\n4:["$","tr",null,{"children":["$","td",null,{"height":"32","style":{"height":"32px","lineHeight":"32px","fontSize":"0"},"children":" "}]}]\n"])</script><script>self.__next_f.push([1,"5:["$","tr",null,{"children":["$","td",null,{"children":["$","table",null,{"role":"presentation","width":"360","align":"center","cellPadding":"0","cellSpacing":"0","style":{"width":"360px","maxWidth":"100%","borderSpacing":"0","height":"$undefined"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"style":{"backgroundColor":"#ffffff","borderRadius":"16px"},"children":[["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":{"borderSpacing":"0"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":[["$","td",null,{"align":"left","style":{"padding":"10px 0 0 10px"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-left.png","width":"16","height":"16","alt":"","style":{"display":"block","border":0,"outline":"none","textDecoration":"none"}}]}],["$","td",null,{"align":"right","style":{"padding":"10px 10px 0 0"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-right.png","width":"16","height":"16","alt":"","style":"$5:props:children:props:children:props:children:props:children:props:children:props:children:0:props:children:props:children:props:children:0:props:children:props:style"}]}]]}]}]}],["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":"$5:props:children:props:children:props:children:props:children:props:children:props:children:0:props:style","children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"align":"center","valign":"top","style":{"padding":"32px 32px 24px 32px"},"children":[["$","table",null,{"role":"presentation","width":"296","align":"center","cellPadding":"0","cellSpacing":"0","style":{"width":"296px","maxWidth":"100%","margin":"0 auto","borderSpacing":"0"},"children":["$","tbody",null,{"children":[["$","tr",null,{"children":["$","td",null,{"style":{"height":"26px"},"children":["$","p",null,{"style":{"fontFamily":"Inter, Arial, sans-serif","margin":0,"color":"#1c1b1f","textAlign":"center","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em"},"children":"Your temporary password is"}]}]}],["$","tr",null,{"children":["$","td",null,{"height":"8","style":{"height":"8px","lineHeight":"8px","fontSize":"0"},"children":" "}]}],["$","tr",null,{"children":["$","td",null,{"style":{"height":"30px"},"children":["$","p",null,{"style":{"fontFamily":"Inter, Arial, sans-serif","margin":0,"color":"#1c1b1f","textAlign":"center","fontWeight":600,"fontSize":"20px","lineHeight":"150%","letterSpacing":"-0.01em"},"children":"$${escapedPassword}"}]}]}]]}]}],["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":"$0:f:0:1:2:children:2:children:1:props:children:0:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:1:props:children:props:style","children":["$","tbody",null,{"children":[["$","tr",null,{"children":["$","td",null,{"height":"24","style":{"height":"24px","lineHeight":"24px","fontSize":"0"},"children":" "}]}],["$","tr",null,{"children":["$","td",null,{"align":"center","children":["$","table",null,{"role":"presentation","cellPadding":"0","cellSpacing":"0","style":{"borderSpacing":"0","margin":"0 auto"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"align":"center","style":{"backgroundColor":"#1c1b1f","borderRadius":"222px","height":"45px"},"children":["$","a",null,{"href":"https://dapp.oko.app","style":{"display":"inline-block","padding":"12px 32px","fontFamily":"Inter, Arial, sans-serif","fontWeight":500,"fontSize":"14px","lineHeight":"150%","letterSpacing":"-0.01em","color":"#fffffe","textDecoration":"none","textAlign":"center"},"children":"Sign In"}]}]}]}]}]}]}]]}]}],["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":"$0:f:0:1:2:children:2:children:1:props:children:0:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:1:props:children:props:style","children":["$","tbody",null,{"children":[["$","tr",null,{"children":["$","td",null,{"height":"24","style":"$5:props:children:props:children:props:children:props:children:props:children:props:children:1:props:children:props:children:props:children:props:children:1:props:children:props:children:0:props:children:props:style","children":" "}]}],["$","tr",null,{"children":["$","td",null,{"align":"center","children":["$","table",null,{"role":"presentation","width":"296","cellPadding":"0","cellSpacing":"0","style":{"width":"296px","maxWidth":"100%","borderSpacing":"0"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"children":["$","p",null,{"style":{"fontFamily":"Inter, Arial, sans-serif","margin":0,"color":"rgba(28, 27, 31, 0.5)","textAlign":"center","fontWeight":500,"fontSize":"14px","lineHeight":"150%","letterSpacing":"-0.01em"},"children":"Please sign in and update your password after your first login."}]}]}]}]}]}]}]]}]}]]}]}]}]}],["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":"$5:props:children:props:children:props:children:props:children:props:children:props:children:0:props:style","children":["$","tbody",null,{"children":["$","tr",null,{"children":[["$","td",null,{"align":"left","style":{"padding":"0 0 10px 10px"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-left.png","width":"16","height":"16","alt":"","style":"$5:props:children:props:children:props:children:props:children:props:children:props:children:0:props:children:props:children:props:children:0:props:children:props:style"}]}],["$","td",null,{"align":"right","style":{"padding":"0 10px 10px 0"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-right.png","width":"16","height":"16","alt":"","style":"$5:props:children:props:children:props:children:props:children:props:children:props:children:0:props:children:props:children:props:children:0:props:children:props:style"}]}]]}]}]}]]}]}]}]}]}]}]\n"])</script><script>self.__next_f.push([1,"6:["$","tr",null,{"children":["$","td",null,{"height":"32","style":"$4:props:children:props:style","children":" "}]}]\n"])</script><script>self.__next_f.push([1,"7:["$","tr",null,{"children":["$","td",null,{"children":[["$","table",null,{"role":"presentation","width":"360","cellPadding":"0","cellSpacing":"0","style":{"width":"360px","maxWidth":"100%","borderSpacing":"0"},"children":["$","tbody",null,{"children":[["$","tr",null,{"children":["$","td",null,{"children":["$","p",null,{"style":{"fontFamily":"Inter, Arial, sans-serif","margin":0,"color":"#1c1b1f","textAlign":"left","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em"},"children":"Here are a few links that may help during integration:"}]}]}],["$","tr",null,{"children":["$","td",null,{"height":"16","style":{"height":"16px","lineHeight":"16px","fontSize":"0"},"children":" "}]}]]}]}],["$","table",null,{"role":"presentation","width":"360","align":"center","cellPadding":"0","cellSpacing":"0","style":{"width":"360px","maxWidth":"100%","borderSpacing":"0"},"children":["$","tbody",null,{"children":[["$","tr",null,{"children":["$","td",null,{"children":["$","table",null,{"role":"presentation","width":"360","cellPadding":"0","cellSpacing":"0","style":{"width":"360px","borderSpacing":"0"},"children":["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"width":"16","style":{"width":"16px","paddingRight":"12px"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/icon-demo.png","width":"16","height":"16","alt":"","style":{"display":"block","width":"16px","height":"16px"}}]}],["$","td",null,{"children":["$","a",null,{"href":"https://demo.oko.app/","style":{"fontFamily":"Inter, Arial, sans-serif","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em","color":"#1c1b1f","textDecoration":"underline"},"children":"Demo"}]}]]}],["$","tr",null,{"children":["$","td",null,{"height":"8","colSpan":2,"style":{"height":"8px","lineHeight":"8px","fontSize":"0"},"children":" "}]}],["$","tr",null,{"children":[["$","td",null,{"width":"16","style":"$7:props:children:props:children:1:props:children:props:children:0:props:children:props:children:props:children:props:children:0:props:children:0:props:style","children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/icon-docs.png","width":"16","height":"16","alt":"","style":"$7:props:children:props:children:1:props:children:props:children:0:props:children:props:children:props:children:props:children:0:props:children:0:props:children:props:style"}]}],["$","td",null,{"children":["$","a",null,{"href":"https://docs.oko.app/docs","style":"$7:props:children:props:children:1:props:children:props:children:0:props:children:props:children:props:children:props:children:0:props:children:1:props:children:props:style","children":"Docs"}]}]]}],["$","tr",null,{"children":["$","td",null,{"height":"8","colSpan":2,"style":"$7:props:children:props:children:1:props:children:props:children:0:props:children:props:children:props:children:props:children:1:props:children:props:style","children":" "}]}],["$","tr",null,{"children":[["$","td",null,{"width":"16","style":"$7:props:children:props:children:1:props:children:props:children:0:props:children:props:children:props:children:props:children:0:props:children:0:props:style","children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/icon-inquiries.png","width":"16","height":"16","alt":"","style":"$7:props:children:props:children:1:props:children:props:children:0:props:children:props:children:props:children:props:children:0:props:children:0:props:children:props:style"}]}],["$","td",null,{"children":["$","a",null,{"href":"https://oko-wallet.canny.io/integration-support-inquiries","style":"$7:props:children:props:children:1:props:children:props:children:0:props:children:props:children:props:children:props:children:0:props:children:1:props:children:props:style","children":"Integration Inquiries"}]}]]}]]}]}]}]}],["$","tr",null,{"children":["$","td",null,{"height":"32","style":{"height":"32px","lineHeight":"32px","fontSize":"0"},"children":" "}]}],["$","tr",null,{"children":["$","td",null,{"children":["$","p",null,{"style":{"margin":0,"fontFamily":"Inter, Arial, sans-serif","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em","color":"#1c1b1f"},"children":"Thanks!"}]}]}],["$","tr",null,{"children":["$","td",null,{"height":"32","style":"$7:props:children:props:children:1:props:children:props:children:1:props:children:props:style","children":" "}]}],["$","tr",null,{"children":["$","td",null,{"align":"center","children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/logo-footer.png","width":"64","height":"25","alt":"Oko Logo","style":{"display":"block","width":"64px","height":"25px"}}]}]}]]}]}]]}]}]\n"])</script><script>self.__next_f.push([1,"8:["$","$Lb",null,{"children":["$Lc",["$","$Ld",null,{"promise":"$@e"}]]}]\n9:["$","$1","h",{"children":[null,[["$","$Lf",null,{"children":"$L10"}],null],["$","$L11",null,{"children":["$","div",null,{"hidden":true,"children":["$","$12",null,{"fallback":null,"children":"$L13"}]}]}]]}]\n"])</script><script>self.__next_f.push([1,"10:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]\nc:null\n"])</script><script>self.__next_f.push([1,"e:{"metadata":[["$","title","0",{"children":"Oko Email Template"}]],"error":null,"digest":"$undefined"}\n"])</script><script>self.__next_f.push([1,"13:"$e:metadata"\n"])</script></body></html>
  `;

  console.info(
    "Sending initial password email, email: %s, content len: %s",
    email,
    html.length,
  );

  return sendEmail(
    {
      from: from_email,
      to: email,
      subject,
      html,
    },
    smtp_config,
  );
}
