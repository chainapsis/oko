import type { EmailResult, SMTPConfig } from "@oko-wallet/oko-types/admin";

import { sendEmail } from "@oko-wallet-admin-api/email";

export async function sendPasswordResetEmail(
  email: string,
  verification_code: string,
  customer_label: string,
  from_email: string,
  email_verification_expiration_minutes: number,
  smtp_config: SMTPConfig,
): Promise<EmailResult> {
  const subject = `Reset Password Verification Code for ${customer_label}`;

  const html = `
    <!DOCTYPE html><!--KZB6O2IjHFZlkke60HoRs--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/reset_code_header.png" as="image"/><link rel="preload" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-left.png" as="image"/><link rel="preload" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-right.png" as="image"/><link rel="preload" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/code-key-icon.png" as="image"/><link rel="preload" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-left.png" as="image"/><link rel="preload" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-right.png" as="image"/><link rel="preload" href="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/logo-footer.png" as="image"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/cbd55ab9639e1e66.js"/><script src="/_next/static/chunks/d4049e5069cb8a2e.js" async=""></script><script src="/_next/static/chunks/0acaec1566f6678e.js" async=""></script><script src="/_next/static/chunks/turbopack-870bf0e3550be71d.js" async=""></script><script src="/_next/static/chunks/a6e5f733cef464a6.js" async=""></script><title>Oko Email Template</title><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><div style="background-color:#ededed;font-family:Inter, Arial, sans-serif"><table align="center" role="presentation" cellPadding="0" cellSpacing="0" style="width:100%;background-color:#ededed"><tbody><tr><td style="padding:32px 0 32px 0"><table align="center" role="presentation" cellPadding="0" cellSpacing="0" style="width:600px;max-width:100%;margin:0 auto;border-spacing:0"><tbody><tr><td style="padding:0"><table role="presentation" style="width:100%;background-color:#ededed;border-radius:28px;border-spacing:0" cellPadding="0" cellSpacing="0"><tbody><tr><td style="padding-top:8px;padding-left:8px;padding-right:8px;padding-bottom:8px"><div style="padding:2px"><div style="position:relative;width:100%"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/reset_code_header.png" width="584" alt="Oko password reset code header" style="display:block;width:584px;max-width:100%;border-radius:20px"/></div><div style="width:100%"><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td align="center" valign="top" style="padding-top:32px"><table role="presentation" width="360" cellPadding="0" cellSpacing="0" style="width:360px;max-width:100%;border-spacing:0"><tbody><tr><td><p style="font-family:Inter, Arial, sans-serif;margin:0;color:#1c1b1f;text-align:center;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em">Enter this code in your Oko Dashboard to reset your password.<br/>The code is valid for<!-- --> <!-- -->${email_verification_expiration_minutes}<!-- --> minute for your security.</p></td></tr><tr><td height="32" style="height:32px;line-height:32px;font-size:0"> </td></tr><tr><td><table role="presentation" width="360" align="center" cellPadding="0" cellSpacing="0" style="width:360px;max-width:100%;border-spacing:0"><tbody><tr><td style="background-color:#ffffff;border-radius:16px"><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td align="left" style="padding:10px 0 0 10px"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-left.png" width="16" height="16" alt="" style="display:block;border:0;outline:none;text-decoration:none"/></td><td align="right" style="padding:10px 10px 0 0"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-right.png" width="16" height="16" alt="" style="display:block;border:0;outline:none;text-decoration:none"/></td></tr></tbody></table><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td align="center" valign="top" style="padding:48px 32px"><table role="presentation" width="296" align="center" cellPadding="0" cellSpacing="0" style="width:296px;max-width:100%;margin:0 auto;border-spacing:0"><tbody><tr><td style="vertical-align:top"><p style="margin:0;font-family:Inter, Arial, sans-serif;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em;color:#1c1b1f;text-align:center">Your 6-digit code<br/>for changing your password</p></td></tr><tr><td height="16" style="height:16px;line-height:16px;font-size:0"> </td></tr><tr><td><p style="margin:0;font-family:Inter, Arial, sans-serif;font-weight:600;font-size:40px;line-height:100%;letter-spacing:-0.03em;color:#1c1b1f;text-align:center">${verification_code}</p></td></tr><tr><td height="24" style="height:24px;line-height:24px;font-size:0"> </td></tr><tr><td align="center" style="height:24px"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/code-key-icon.png" width="24" height="24" alt="" style="display:block;width:24px;height:24px"/></td></tr></tbody></table></td></tr></tbody></table><table role="presentation" width="100%" cellPadding="0" cellSpacing="0" style="border-spacing:0"><tbody><tr><td align="left" style="padding:0 0 10px 10px"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-left.png" width="16" height="16" alt="" style="display:block;border:0;outline:none;text-decoration:none"/></td><td align="right" style="padding:0 10px 10px 0"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-right.png" width="16" height="16" alt="" style="display:block;border:0;outline:none;text-decoration:none"/></td></tr></tbody></table></td></tr></tbody></table></td></tr><tr><td height="32" style="height:32px;line-height:32px;font-size:0"> </td></tr><tr><td><p style="font-family:Inter, Arial, sans-serif;margin:0;color:#1c1b1f;text-align:center;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em">If you didn&#x27;t make this request, you can safely delete this email.</p></td></tr><tr><td height="32" style="height:32px;line-height:32px;font-size:0"> </td></tr><tr><td><table role="presentation" width="360" cellPadding="0" cellSpacing="0" align="center" style="width:360px;max-width:100%;border-spacing:0;height:26px"><tbody><tr><td align="center"><p style="font-family:Inter, Arial, sans-serif;margin:0;color:#1c1b1f;text-align:center;font-weight:500;font-size:16px;line-height:160%;letter-spacing:-0.01em">Oko Team</p></td></tr></tbody></table></td></tr><tr><td height="33.72" style="height:33.72px;line-height:33.72px;font-size:0"> </td></tr><tr><td align="center"><img src="https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/logo-footer.png" width="64" height="25" alt="Gray Oko logo" style="display:block;width:64px;height:25px"/></td></tr></tbody></table></td></tr></tbody></table></div></div></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></div><!--$--><!--/$--><script src="/_next/static/chunks/cbd55ab9639e1e66.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:"$Sreact.fragment"\n2:I[39756,["/_next/static/chunks/a6e5f733cef464a6.js"],"default"]\n3:I[37457,["/_next/static/chunks/a6e5f733cef464a6.js"],"default"]\nf:I[68027,["/_next/static/chunks/a6e5f733cef464a6.js"],"default"]\n:HL["https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/reset_code_header.png","image"]\n"])</script><script>self.__next_f.push([1,"0:{"P":null,"b":"KZB6O2IjHFZlkke60HoRs","c":["","reset_pw_code"],"q":"","i":false,"f":[[["",{"children":["reset_pw_code",{"children":["__PAGE__",{}]}]},"$undefined","$undefined",true],[["$","$1","c",{"children":[null,["$","html",null,{"lang":"en","children":["$","body",null,{"children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\\"Segoe UI\\",Roboto,Helvetica,Arial,sans-serif,\\"Apple Color Emoji\\",\\"Segoe UI Emoji\\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}],{"children":[["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":[["$","div",null,{"style":{"backgroundColor":"#ededed","fontFamily":"Inter, Arial, sans-serif"},"children":["$","table",null,{"align":"center","role":"presentation","cellPadding":"0","cellSpacing":"0","style":{"width":"100%","backgroundColor":"#ededed"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"style":{"padding":"32px 0 32px 0"},"children":["$","table",null,{"align":"center","role":"presentation","cellPadding":"0","cellSpacing":"0","style":{"width":"600px","maxWidth":"100%","margin":"0 auto","borderSpacing":"0"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"style":{"padding":"0"},"children":["$","table",null,{"role":"presentation","style":{"width":"100%","backgroundColor":"#ededed","borderRadius":"28px","borderSpacing":"0"},"cellPadding":"0","cellSpacing":"0","children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"style":{"paddingTop":"8px","paddingLeft":"8px","paddingRight":"8px","paddingBottom":"8px"},"children":["$","div",null,{"style":{"padding":"2px"},"children":[["$","div",null,{"style":{"position":"relative","width":"100%"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/reset_code_header.png","width":"584","alt":"Oko password reset code header","style":{"display":"block","width":"584px","maxWidth":"100%","borderRadius":"20px"}}]}],["$","div",null,{"style":{"width":"100%"},"children":["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":{"borderSpacing":"0"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"align":"center","valign":"top","style":{"paddingTop":"32px"},"children":["$","table",null,{"role":"presentation","width":"360","cellPadding":"0","cellSpacing":"0","style":{"width":"360px","maxWidth":"100%","borderSpacing":"0"},"children":["$","tbody",null,{"children":[["$","tr",null,{"children":["$","td",null,{"children":["$","p",null,{"style":{"fontFamily":"Inter, Arial, sans-serif","margin":0,"color":"#1c1b1f","textAlign":"center","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em"},"children":["Enter this code in your Oko Dashboard to reset your password.",["$","br",null,{}],"The code is valid for"," ","$${email_verification_expiration_minutes}"," minute for your security."]}]}]}],["$","tr",null,{"children":["$","td",null,{"height":"32","style":{"height":"32px","lineHeight":"32px","fontSize":"0"},"children":" "}]}],["$","tr",null,{"children":["$","td",null,{"children":["$","table",null,{"role":"presentation","width":"360","align":"center","cellPadding":"0","cellSpacing":"0","style":{"width":"360px","maxWidth":"100%","borderSpacing":"0","height":"$undefined"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"style":{"backgroundColor":"#ffffff","borderRadius":"16px"},"children":[["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":{"borderSpacing":"0"},"children":"$L4"}],"$L5","$L6"]}]}]}]}]}]}],"$L7","$L8","$L9","$La","$Lb","$Lc"]}]}]}]}]}]}]}]]}]}]}]}]}]}]}]}]}]}]}]}]}]}],null,"$Ld"]}],{},null,false,false]},null,false,false]},null,false,false],"$Le",false]],"m":"$undefined","G":["$f",[]],"S":true}\n"])</script><script>self.__next_f.push([1,"10:I[97367,["/_next/static/chunks/a6e5f733cef464a6.js"],"OutletBoundary"]\n11:"$Sreact.suspense"\n13:I[97367,["/_next/static/chunks/a6e5f733cef464a6.js"],"ViewportBoundary"]\n15:I[97367,["/_next/static/chunks/a6e5f733cef464a6.js"],"MetadataBoundary"]\n:HL["https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-left.png","image"]\n:HL["https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-right.png","image"]\n:HL["https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/code-key-icon.png","image"]\n:HL["https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-left.png","image"]\n:HL["https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-right.png","image"]\n:HL["https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/logo-footer.png","image"]\n4:["$","tbody",null,{"children":["$","tr",null,{"children":[["$","td",null,{"align":"left","style":{"padding":"10px 0 0 10px"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-left.png","width":"16","height":"16","alt":"","style":{"display":"block","border":0,"outline":"none","textDecoration":"none"}}]}],["$","td",null,{"align":"right","style":{"padding":"10px 10px 0 0"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-top-right.png","width":"16","height":"16","alt":"","style":"$4:props:children:props:children:0:props:children:props:style"}]}]]}]}]\n"])</script><script>self.__next_f.push([1,"5:["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":"$0:f:0:1:1:children:1:children:0:props:children:0:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:1:props:children:props:children:props:children:props:children:props:children:props:children:props:children:2:props:children:props:children:props:children:props:children:props:children:props:children:0:props:style","children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"align":"center","valign":"top","style":{"padding":"48px 32px"},"children":["$","table",null,{"role":"presentation","width":"296","align":"center","cellPadding":"0","cellSpacing":"0","style":{"width":"296px","maxWidth":"100%","margin":"0 auto","borderSpacing":"0"},"children":["$","tbody",null,{"children":[["$","tr",null,{"children":["$","td",null,{"style":{"verticalAlign":"top"},"children":["$","p",null,{"style":{"margin":0,"fontFamily":"Inter, Arial, sans-serif","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em","color":"#1c1b1f","textAlign":"center"},"children":["Your 6-digit code",["$","br",null,{}],"for changing your password"]}]}]}],["$","tr",null,{"children":["$","td",null,{"height":"16","style":{"height":"16px","lineHeight":"16px","fontSize":"0"},"children":" "}]}],["$","tr",null,{"children":["$","td",null,{"style":{},"children":["$","p",null,{"style":{"margin":0,"fontFamily":"Inter, Arial, sans-serif","fontWeight":600,"fontSize":"40px","lineHeight":"100%","letterSpacing":"-0.03em","color":"#1c1b1f","textAlign":"center"},"children":"$${verification_code}"}]}]}],["$","tr",null,{"children":["$","td",null,{"height":"24","style":{"height":"24px","lineHeight":"24px","fontSize":"0"},"children":" "}]}],["$","tr",null,{"children":["$","td",null,{"align":"center","style":{"height":"24px"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/code-key-icon.png","width":"24","height":"24","alt":"","style":{"display":"block","width":"24px","height":"24px"}}]}]}]]}]}]}]}]}]}]\n"])</script><script>self.__next_f.push([1,"6:["$","table",null,{"role":"presentation","width":"100%","cellPadding":"0","cellSpacing":"0","style":"$0:f:0:1:1:children:1:children:0:props:children:0:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:1:props:children:props:children:props:children:props:children:props:children:props:children:props:children:2:props:children:props:children:props:children:props:children:props:children:props:children:0:props:style","children":["$","tbody",null,{"children":["$","tr",null,{"children":[["$","td",null,{"align":"left","style":{"padding":"0 0 10px 10px"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-left.png","width":"16","height":"16","alt":"","style":"$4:props:children:props:children:0:props:children:props:style"}]}],["$","td",null,{"align":"right","style":{"padding":"0 10px 10px 0"},"children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/screw-bottom-right.png","width":"16","height":"16","alt":"","style":"$4:props:children:props:children:0:props:children:props:style"}]}]]}]}]}]\n7:["$","tr",null,{"children":["$","td",null,{"height":"32","style":"$0:f:0:1:1:children:1:children:0:props:children:0:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:1:props:children:props:children:props:children:props:children:props:children:props:children:props:children:1:props:children:props:style","children":" "}]}]\n8:["$","tr",null,{"children":["$","td",null,{"children":["$","p",null,{"style":{"fontFamily":"Inter, Arial, sans-serif","margin":0,"color":"#1c1b1f","textAlign":"center","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em"},"children":"If you didn't make this request, you can safely delete this email."}]}]}]\n9:["$","tr",null,{"children":["$","td",null,{"height":"32","style":"$0:f:0:1:1:children:1:children:0:props:children:0:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:props:children:1:props:children:props:children:props:children:props:children:props:children:props:children:props:children:1:props:children:props:style","children":" "}]}]\na:["$","tr",null,{"children":["$","td",null,{"children":["$","table",null,{"role":"presentation","width":"360","cellPadding":"0","cellSpacing":"0","align":"center","style":{"width":"360px","maxWidth":"100%","borderSpacing":"0","height":"26px"},"children":["$","tbody",null,{"children":["$","tr",null,{"children":["$","td",null,{"align":"center","children":["$","p",null,{"style":{"fontFamily":"Inter, Arial, sans-serif","margin":0,"color":"#1c1b1f","textAlign":"center","fontWeight":500,"fontSize":"16px","lineHeight":"160%","letterSpacing":"-0.01em"},"children":"Oko Team"}]}]}]}]}]}]}]\nb:["$","tr",null,{"children":["$","td",null,{"height":"33.72","style":{"height":"33.72px","lineHeight":"33.72px","fontSize":"0"},"children":" "}]}]\nc:["$","tr",null,{"children":["$","td",null,{"align":"center","children":["$","img",null,{"src":"https://oko-wallet.s3.ap-northeast-2.amazonaws.com/assets/email/light/logo-footer.png","width":"64","height":"25","alt":"Gray Oko logo","style":{"display":"block","width":"64px","height":"25px"}}]}]}]\nd:["$","$L10",null,{"children":["$","$11",null,{"name":"Next.MetadataOutlet","children":"$@12"}]}]\ne:["$","$1","h",{"children":[null,["$","$L13",null,{"children":"$L14"}],["$","div",null,{"hidden":true,"children":["$","$L15",null,{"children":["$","$11",null,{"name":"Next.Metadata","children":"$L16"}]}]}],null]}]\n"])</script><script>self.__next_f.push([1,"14:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]\n"])</script><script>self.__next_f.push([1,"12:null\n16:[["$","title","0",{"children":"Oko Email Template"}]]\n"])</script></body></html>
  `;

  console.info(
    "Sending password reset email, email: %s, content len: %s",
    email,
    html.length,
  );

  return sendEmail(
    {
      from: from_email,
      to: email,
      subject,
      html,
    },
    smtp_config,
  );
}
